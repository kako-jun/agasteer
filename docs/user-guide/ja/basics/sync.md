# GitHub同期

GitHubへの保存（Push）と取得（Pull）について説明します。

---

## GitHubへの保存（Push）

GitHub連携を設定している場合、編集内容をGitHubに保存できます。

### 保存方法

- フッターの「💾」ボタンをタップ
- または **Ctrl+S**（Macは **Cmd+S**）

### 未保存の変更

未保存の変更があると、保存ボタンに**赤い丸印**が表示されます。

### Stale警告

別のデバイスで編集された場合、Push前に警告が表示されます。上書きするか、先にPullするか選べます。

### 自動Push

編集後、**42秒間無操作**が続くと自動的にGitHubへPushされます。

- 手動で保存する手間を省けます
- 操作中（キー入力、クリック、スクロールなど）は自動Pushされません
- 保存ボタンの下に進捗バーが表示され、次の自動Pushまでの時間がわかります

> **💡 Tip**: 急いで保存したい場合は、手動で保存ボタンを押すか Ctrl+S を使ってください。

---

## GitHubからの取得（Pull）

GitHub上の最新データをブラウザに同期します。

### Pull方法

- ヘッダー左側の「⬇️」ボタンをタップ
- PWA版ではリロードボタンがないため、このボタンでPullします

### 自動Pull

アプリ起動時に自動的にPullが実行されます。

### バックグラウンドチェック

5分間隔でリモートの変更を自動チェックします。新しい変更がある場合：

- **未保存の変更がない場合** → 自動的にPullが実行されます
- **未保存の変更がある場合** → Pullボタンに赤い丸印が表示されます（手動でPullしてください）

> **💡 Tip**: 5分間無操作で未保存の変更がなければ、他のデバイスでの変更が自動的に反映されます。

---

## データ保護機能

### ページ離脱時の確認

未保存の変更がある状態で、タブを閉じたりリロードしようとすると、ブラウザの確認ダイアログが表示されます。

- 誤って変更を失うのを防ぎます
- アプリ内のナビゲーションでは表示されません（自動保存のため）

### Stale進捗バー

ヘッダー左端に細い縦線（進捗バー）が表示されます。

- **5分間隔**でリモートの変更を自動チェック
- バーが上から下に伸び、満タンになるとチェック実行
- 他のデバイスで変更があった場合、Pullボタンに赤丸が表示される

> **💡 Tip**: 手動でPull/Pushすると、次のチェックまでのカウントダウンがリセットされます。

### Pull中の読み取り専用モード

Pull中は編集エリアに半透明のオーバーレイ（ガラス効果）がかかり、編集できなくなります。

- データの整合性を保つため
- Offlineリーフは例外（Pull中でも編集可能）
- **Pull中はArchiveへの切り替えもできません**（データの不整合を防ぐため）

---

## リポジトリ切替時の動作

設定画面でリポジトリを変更すると、以下の処理が自動的に行われます：

- **ホームデータ**: 設定画面を閉じた時に、新しいリポジトリから自動的にPullされます
- **アーカイブデータ**: クリアされます。次回アーカイブを表示した時に、新しいリポジトリから取得されます
- **未保存の変更**: リセットされます。切り替え前に保存（Push）しておいてください
- **同期チェック**: stale検出やPush履歴もリセットされ、新しいリポジトリの状態で再開します

> **💡 Tip**: テーマやツール名だけを変更した場合は、Pullは実行されません。リポジトリの変更があった場合のみ、自動Pullが実行されます。

---

## 統計情報

ホーム画面右下に統計が表示されます。

| 項目         | 説明                 |
| ------------ | -------------------- |
| **リーフ数** | 作成したリーフの総数 |
| **文字数**   | 全リーフの総文字数   |
| **Push回数** | GitHubへのPush回数   |
